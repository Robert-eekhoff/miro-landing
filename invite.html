<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>You're invited to Miiro</title>
<meta name="description" content="Join Miiro and get your first month of Miiro+ free. Your household, finally in sync.">
<meta property="og:title" content="You're invited to Miiro">
<meta property="og:description" content="Join Miiro and get your first month of Miiro+ free. Your household, finally in sync.">
<meta property="og:type" content="website">
<meta property="og:image" content="/koi-logo.png">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display:ital@0;1&family=DM+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
:root {
  --ink: #1a1a2e;
  --paper: #FAF9F6;
  --warm: #F3F0EB;
  --sand: #E4DED4;
  --stone: #8C8578;
  --charcoal: #3D3A36;
  --indigo: #4A5CE8;
  --coral: #E8634A;
  --mint: #3BBFA0;
  --plum: #7B4AE8;
}

* { margin: 0; padding: 0; box-sizing: border-box; }
html { scroll-behavior: smooth; }

body {
  font-family: 'DM Sans', sans-serif;
  color: var(--charcoal);
  background: var(--paper);
  -webkit-font-smoothing: antialiased;
  min-height: 100vh;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 24px;
  line-height: 1.6;
}

.brand-ii { color: var(--indigo); }

@keyframes fadeUp {
  from { opacity: 0; transform: translateY(20px); }
  to { opacity: 1; transform: translateY(0); }
}

.invite-container {
  max-width: 420px;
  width: 100%;
  text-align: center;
  animation: fadeUp 0.6s ease-out;
}

.logo {
  width: 80px;
  height: 80px;
  margin: 0 auto 24px;
  object-fit: contain;
}

.invite-heading {
  font-family: 'DM Serif Display', serif;
  font-size: 1.8rem;
  color: var(--ink);
  margin-bottom: 8px;
  letter-spacing: -0.02em;
  line-height: 1.3;
}

.invite-tagline {
  font-size: 1rem;
  color: var(--stone);
  margin-bottom: 32px;
}

.features {
  display: flex;
  flex-direction: column;
  gap: 12px;
  margin-bottom: 28px;
  text-align: left;
}

.feature-row {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 12px 16px;
  background: var(--warm);
  border-radius: 12px;
}

.feature-icon {
  width: 36px;
  height: 36px;
  border-radius: 10px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.1rem;
  flex-shrink: 0;
}

.feature-text {
  font-size: 0.9rem;
  font-weight: 500;
  color: var(--charcoal);
}

.free-badge {
  background: linear-gradient(135deg, var(--plum), var(--indigo));
  color: #fff;
  padding: 10px 20px;
  border-radius: 12px;
  font-size: 0.85rem;
  font-weight: 700;
  letter-spacing: 0.3px;
  margin-bottom: 24px;
  display: inline-block;
}

.download-btn {
  display: block;
  width: 100%;
  padding: 16px;
  background: var(--indigo);
  color: #fff;
  font-family: 'DM Sans', sans-serif;
  font-size: 1.05rem;
  font-weight: 700;
  border: none;
  border-radius: 14px;
  cursor: pointer;
  transition: transform 0.15s, box-shadow 0.2s;
  text-decoration: none;
  margin-bottom: 12px;
}

.download-btn:hover {
  transform: translateY(-1px);
  box-shadow: 0 4px 16px rgba(74, 92, 232, 0.3);
}

.download-btn:active {
  transform: translateY(0);
}

.app-store-badge {
  display: flex;
  justify-content: center;
  margin-bottom: 20px;
}

.app-store-badge img {
  height: 44px;
}

.toast {
  position: fixed;
  bottom: 24px;
  left: 50%;
  transform: translateX(-50%) translateY(80px);
  background: var(--ink);
  color: #fff;
  padding: 12px 24px;
  border-radius: 12px;
  font-size: 0.85rem;
  font-weight: 600;
  opacity: 0;
  transition: all 0.3s ease;
  z-index: 100;
  white-space: nowrap;
}

.toast.visible {
  opacity: 1;
  transform: translateX(-50%) translateY(0);
}

.footer-text {
  font-size: 0.75rem;
  color: var(--stone);
  margin-top: 24px;
}

.footer-text a {
  color: var(--stone);
  text-decoration: underline;
}

.loading-state {
  color: var(--stone);
  font-size: 0.9rem;
}
</style>
</head>
<body>

<div class="invite-container">
  <img src="/koi-logo.png" alt="Miiro" class="logo">

  <h1 class="invite-heading" id="heading">You've been invited to M<span class="brand-ii">ii</span>ro</h1>
  <p class="invite-tagline">See what matters</p>

  <div class="features">
    <div class="feature-row">
      <div class="feature-icon" style="background: rgba(74,92,232,0.1);">üçΩÔ∏è</div>
      <span class="feature-text">Plan meals together</span>
    </div>
    <div class="feature-row">
      <div class="feature-icon" style="background: rgba(232,99,74,0.1);">üõí</div>
      <span class="feature-text">Shared grocery lists</span>
    </div>
    <div class="feature-row">
      <div class="feature-icon" style="background: rgba(59,191,160,0.1);">‚úÖ</div>
      <span class="feature-text">Household tasks, in sync</span>
    </div>
    <div class="feature-row">
      <div class="feature-icon" style="background: rgba(123,74,232,0.1);">üìÖ</div>
      <span class="feature-text">Shared family calendars</span>
    </div>
  </div>

  <div class="free-badge">Your first month of Miiro+ is free</div>

  <br>

  <button class="download-btn" id="downloadBtn" onclick="handleDownload()">
    Download Miiro Free
  </button>

  <p class="footer-text">
    <a href="/privacy">Privacy</a> ¬∑ <a href="/terms">Terms</a>
  </p>
</div>

<div class="toast" id="toast">Referral code copied!</div>

<script>
(function() {
  const pathParts = window.location.pathname.split('/invite/');
  const code = pathParts[1] ? pathParts[1].replace(/\/$/, '') : null;

  // Personalize heading with referrer's name
  // SECURITY: HTML-escape firstName to prevent XSS via user-controlled display names
  function escapeHtml(str) {
    var div = document.createElement('div');
    div.appendChild(document.createTextNode(str));
    return div.innerHTML;
  }

  if (code && /^MIIRO-[A-Z0-9]{6}$/.test(code)) {
    fetch('https://us-central1-mirert-ec2a5.cloudfunctions.net/lookupReferralCode?code=' + encodeURIComponent(code))
      .then(function(res) { return res.json(); })
      .then(function(data) {
        if (data.firstName) {
          document.getElementById('heading').innerHTML =
            escapeHtml(data.firstName) + ' wants to coordinate their household with you on M<span class="brand-ii">ii</span>ro';
        }
      })
      .catch(function() { /* keep fallback heading */ });
  }

  window.handleDownload = function() {
    // Copy referral code to clipboard
    if (code) {
      if (navigator.clipboard && navigator.clipboard.writeText) {
        navigator.clipboard.writeText(code).then(function() {
          showToast();
        }).catch(function() {
          fallbackCopy(code);
        });
      } else {
        fallbackCopy(code);
      }
    }
    // Redirect to App Store after brief delay
    setTimeout(function() {
      window.location.href = 'https://apps.apple.com/app/id6759159052';
    }, 600);
  };

  function fallbackCopy(text) {
    var ta = document.createElement('textarea');
    ta.value = text;
    ta.style.position = 'fixed';
    ta.style.left = '-9999px';
    document.body.appendChild(ta);
    ta.select();
    try { document.execCommand('copy'); showToast(); } catch(e) {}
    document.body.removeChild(ta);
  }

  function showToast() {
    var toast = document.getElementById('toast');
    toast.classList.add('visible');
    setTimeout(function() { toast.classList.remove('visible'); }, 2500);
  }
})();
</script>

</body>
</html>
